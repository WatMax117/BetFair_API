# Event Coverage Diagnostics Summary

**Dataset:** `book_risk_l3__vps2026-02-15082222__part1.parquet`  
**Export window:** 2026-02-06 to 2026-02-08 (UTC)

---

## Step 1 – Full-lifecycle coverage

| Metric | Count |
|--------|--------|
| Events with `final_snapshot_t_from_kickoff_min >= 100` | **0** |
| Events with final in [60, 100) min | 0 |
| Events with final in [0, 60) min | **131** |
| Events with final < 0 (pre-match only) | 10 |

**Max t_from_kickoff_min** per market: top values are **~60 min** (e.g. 60.0, 59.9, 59.8).  
**Red flag:** 130 events have max in [40, 65] min → snapshots **stop around 60 minutes** after kickoff.

---

## Step 2 – CLOSED market status

| Metric | Value |
|--------|--------|
| Rows with `market_status == 'CLOSED'` | **0** |
| Markets with at least one CLOSED | **0** |

**Red flag:** CLOSED never appears → collector likely stops before settlement, or status is not persisted.

---

## Step 3 – Snapshot distribution

- **Stops ~60 min (e.g. market 1.251623784):** Snapshots run from ~32 min to **59.4 min** then stop. Pattern: **collector stops mid-match** (Pattern A).
- **Pre-match only (e.g. 1.253170578):** All snapshots before kickoff (negative t_from_kickoff). Pattern: **future match** or no live ingestion (Pattern C).

No event in this export shows snapshots up to the export boundary (e.g. 2026-02-08 00:00) with late match times → **Pattern B (export cutoff)** is not the main cause; the **data itself stops ~60 min** after kickoff.

---

## Step 4 – Export filters

- **Time filter:** `snapshot_at >= date_from AND snapshot_at < date_to` only. No extra cutoff.
- **Status filter:** None (OPEN/CLOSED/SUSPENDED all included).
- **LIMIT:** None.
- **Partition:** part1, part2 by row count; no time truncation.

**Conclusion:** 0 PASS is **not** caused by export filtering. Export is strictly bounded by the requested date window.

---

## Step 5 – Pre-match window

| Metric | Count |
|--------|--------|
| Events with ≥1 pre-match snapshot | 37 |
| Last pre-match gap ≤ 5 min | 7 |
| Last pre-match gap in (5, 20] min | 19 |

Sample: several events have **last pre-match snapshot ~14.8 min** before kickoff → pre-match frequency or collector start time limits how close we get to kickoff.

---

## Step 7 – Soft pass (has_pre_match AND final ≥ 60 min)

**soft_pass count: 0**

So no event has both pre-match coverage and in-match coverage out to 60 min in a way that satisfies the soft rule (likely because max is just under 60 or pre_match is false). Confirms that **partial ingestion is not enough** for even a relaxed pass.

---

## Step 8 – End window 90–150 min

| Metric | Value |
|--------|--------|
| Snapshots in 90–150 min from kickoff | **0** |
| Markets with ≥1 snapshot in 90–150 min | **0** |

**Red flag:** No late snapshots in the dataset → no full-lifecycle data in this export.

---

## Step 6 – Diagnostic matrix

| Symptom | Likely cause |
|---------|--------------|
| No snapshots after ~60 min for (almost all) events | **Collector stops mid-match** or ingestion window ends |
| No CLOSED ever recorded | Collector ends before settlement or status not stored |
| Many pre-kickoff-only / max_t negative | Future matches or export window before kickoff |

---

## Most probable cause

The dataset **is not a full-lifecycle export**:

1. Snapshots **stop around 60 minutes** after kickoff (collector or ingestion stopping).
2. **CLOSED** is never recorded (no post-match/settlement data).
3. Export logic does **not** filter by status or truncate by time; the limit is the **data available in the DB** for the requested window.

---

## Recommended actions

1. **Locate longest available export** (e.g. wider date range or a run that includes settled markets) and re-run `event_coverage_analysis.py`.
2. **Inspect collector runtime and logs:** confirm whether the REST/streaming collector is configured to run for full match length and to capture CLOSED/settlement.
3. **Check DB for CLOSED:** query `market_book_snapshots` (or equivalent) for `status = 'CLOSED'` in the same window to see if status is stored at all.

---

*Generated by `scripts/event_coverage_diagnostics.py`.*
