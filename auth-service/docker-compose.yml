# NetBet Auth Service - Docker Compose
# Usage: Copy .env.example to .env and configure credentials.
#        Place SSL certs in ./certs/ before running.

services:
  auth-service:
    build: .
    container_name: netbet-auth-service
    restart: always
    env_file:
      - .env
    environment:
      - BETFAIR_CERT_PATH=/certs/client-2048.p12
      - CERT_PASSWORD
      - TOKEN_FILE_PATH=/data/ssoid
      - API_HOST=0.0.0.0
      - API_PORT=8080
    volumes:
      # Mount SSL certificates (do not bake into image)
      - ./certs:/certs:ro
      # Shared volume for Java Streaming Service to read ssoid
      - auth-data:/data
    ports:
      - "8080:8080"
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8080/health')"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s

volumes:
  auth-data:
